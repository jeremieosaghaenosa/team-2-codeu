<!DOCTYPE html>
<html>

<head>
  <title>Community Page</title>
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/navigation-loader.js"></script>
  <script>
    /** Fetches users and adds them to the page. */
    function fetchUserList() {
      const url = '/user-list';
      fetch(url).then((response) => {
        return response.json();
      }).then((users) => {
        const list = document.getElementById('list');
        list.innerHTML = '';

        users.forEach((user) => {
          const userListItem = buildUserListItem(user);
          list.appendChild(userListItem);
        });
      });
    }

    /**
     * Builds a list element that contains a link to a user page, e.g.
     * <li><a href="/user-page.html?user=test@example.com">test@example.com</a></li>
     */
    function buildUserListItem(user) {
      const userLink = document.createElement('a');
      userLink.setAttribute('href', '/user-page.html?user=' + user);
      userLink.appendChild(document.createTextNode(user));
      const userListItem = document.createElement('li');
      userListItem.appendChild(userLink);
      return userListItem;
    }

    /* This function creates a map */
    function createMap(){
      const map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 37.422, lng: -122.084},
        zoom: 16
      });
      addLandmark(map, 37.423829, -122.092154, 'Google West Campus',
          'Google West Campus is home to YouTube and Maps.')
      addLandmark(map, 37.421903, -122.084674, 'Stan the T-Rex',
          'This is Stan, the T-Rex statue.')
      addLandmark(map, 37.420919, -122.086619, 'Permanente Creek Trail',
          'Permanente Creek Trail connects Google to a system of bike trails.');
    }

    /** Adds a marker that shows an info window when clicked. */
    function addLandmark(map, lat, lng, title, description){
      const marker = new google.maps.Marker({
        position: {lat: lat, lng: lng},
        map: map,
        title: title
      });
      const infoWindow = new google.maps.InfoWindow({
        content: description
      });
      marker.addListener('click', function() {
        infoWindow.open(map, marker);
      });
    }

    /** Fetches data and populates the UI of the page. */
    function buildUI() {
      addLoginOrLogoutLinkToNavigation();
      fetchUserList();
      createMap();
    }
  </script>
</head>

<body onload="buildUI()">

  <nav>
    <ul id="navigation">
      <li><a href="/">Home</a></li>
      <li><a href="/aboutus.html">About Our Team</a></li>
      <li><a href="/feed.html">Feed</a></li>
      <li><a href="/community.html">Community Page</a></li>
    </ul>
  </nav>
  <div id="content">
    <h1>Community Page</h1>
    <p>Here is a list of every user who has posted a message:</p>
    <hr />
    <ul id="list">Loading...</ul>
  </div>
  <h3>Connect with the people near you!</h3>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTFCc6HykkA_8IKu4bmoXjgve_l2ygqxE"></script>
  <div id="map"></div>
</body>

</html>
